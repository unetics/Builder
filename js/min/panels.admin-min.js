/**
 * Initial setup for the panels interface
 *
 * @copyright Greg Priday 2013
 * @license GPL 2.0 http://www.gnu.org/licenses/gpl-2.0.html
 */
jQuery(function($){panels.animations=$("#panels").data("animations"),$(window).bind("resize",function(e){$(e.target).hasClass("ui-resizable")||$("#panels-container .grid-container").panelsResizeCells()}),$("#panels-container").sortable({items:"> .grid-container",handle:".grid-handle",tolerance:"pointer",stop:function(){$(this).find(".cell").each(function(){$(this).find('input[name$="[grid]"]').val($("#panels-container .grid-container").index($(this).closest(".grid-container")))}),$("#panels-container .panels-container").trigger("refreshcells")}}),$("#grid-add-dialog").show().dialog({dialogClass:"panels-admin-dialog",autoOpen:!1,modal:!1,title:$("#grid-add-dialog").attr("data-title"),open:function(){$(this).find("input").val(2).select();var e=$('<div class="siteorigin-panels ui-widget-overlay ui-widget-overlay ui-front"></div>').css("z-index",80001);$(this).data("overlay",e).closest(".ui-dialog").before(e)},close:function(){$(this).data("overlay").remove()},buttons:[{text:"add",click:function(){var e=Number($("#grid-add-dialog").find("input").val());if(isNaN(e))return alert("Invalid Number"),!1;e=Math.min(10,Math.max(1,Math.round(e)));var n=window.panels.createGrid(e);panels.animations?n.hide().slideDown():n.show(),$("#grid-add-dialog").dialog("close")}}]}).on("keydown",function(e){e.keyCode==$.ui.keyCode.ENTER?(gridAddDialogButtons[panels.i10n.buttons.add](),setTimeout(function(){$("#grid-add-dialog").dialog("close")},1)):e.keyCode===$.ui.keyCode.ESCAPE&&$("#grid-add-dialog").dialog("close")}),$("#panels-dialog").show().dialog({dialogClass:"panels-admin-dialog",autoOpen:!1,resizable:!1,draggable:!1,closeOnEscape:!1,modal:!1,title:$("#panels-dialog").attr("data-title"),minWidth:960,maxHeight:Math.round(.8*$(window).height()),open:function(){var e=$('<div class="siteorigin-panels-ui-widget-overlay ui-widget-overlay ui-front"></div>').css("z-index",80001);$(this).data("overlay",e).closest(".ui-dialog").before(e)},close:function(){$(this).data("overlay").remove(),panels.animations?$("#panels-container .panel.new-panel").hide().slideDown(1e3).removeClass("new-panel"):$("#panels-container .panel.new-panel").show().removeClass("new-panel")}}).on("keydown",function(e){e.keyCode===$.ui.keyCode.ESCAPE&&$(this).dialog("close")}),$("#so-panels-panels .handlediv").click(function(){setTimeout(function(){$(window).resize()},150)}),$("#panels .panels-add").button({}).click(function(){return $("#panels-text-filter-input").val("").keyup(),$("#panels-dialog").dialog("open"),!1}),$("#panels .grid-add").button({}).click(function(){return $("#grid-add-dialog").dialog("open"),!1}),$("#panels-text-filter-input").keyup(function(e){if(13==e.keyCode){var n=$("#panels-dialog .panel-type-list .panel-type:visible");return void(1==n.length&&n.click())}var a=$(this).val().toLowerCase();$("#panels-dialog .panel-type-list .panel-type").show().each(function(){""!=a&&-1==$(this).find("h3").html().toLowerCase().indexOf(a)&&$(this).hide()})}).click(function(){$(this).keyup()}),$("#panels-dialog .panel-type").click(function(){var e=$("#panels-dialog").panelsCreatePanel($(this).attr("data-class"));panels.addPanel(e,null,null,!0),$("#panels-dialog").dialog("close")}),"undefined"!=typeof panelsData?panels.loadPanels(panelsData):panels.createGrid(1),$(window).resize(function(){$(".panels-admin-dialog").filter(":data(dialog)").dialog("option","position","center")}),$(".wp-editor-tabs").find(".wp-switch-editor").click(function(e){var n=$(this);$("#wp-content-editor-container, #post-status-info").show(),$("#so-panels-panels").hide(),$("#wp-content-wrap").removeClass("panels-active"),$("#content-resize-handle").show()}).end().prepend($('<a id="content-panels" class="hide-if-no-js wp-switch-editor switch-panels">'+$("#so-panels-panels h3.hndle span").html()+"</a>").click(function(e){e.preventDefault();var n=$(this);$("#wp-content-wrap, #post-status-info").hide(),$("#so-panels-panels").show().find("> .inside").show(),$(window).resize()})),$("#so-panels-panels #add-to-panels .switch-to-standard").click(function(){$("#wp-content-wrap, #post-status-info").show(),$("#so-panels-panels").hide(),$(window).resize()}),$("#panels-home-page #post-body").show(),$("#panels-home-page #post-body-wrapper").css("background","none"),$("#so-panels-panels").insertAfter("#wp-content-wrap").hide().find(".handlediv").remove().end().find(".hndle").html("").append($("#add-to-panels")),$("#content-panels").click(function(){$(window).resize()}),("undefined"!=typeof panelsData||$("#panels-home-page").length)&&$("#content-panels").click(),setTimeout(function(){("undefined"!=typeof panelsData||$("#panels-home-page").length)&&$("#content-panels").click(),$("#so-panels-panels .hndle").unbind("click"),$("#so-panels-panels .cell").eq(0).click()},150),$("#panels-home-page").length&&($("#content-tmce, #content-html").remove(),$("#content-panels").hide(),$("#panels-toggle-switch").mouseenter(function(){$(this).addClass("subtle-move")}).click(function(){$(this).toggleClass("state-off").toggleClass("state-on").removeClass("subtle-move"),$("#panels-home-enabled").val($(this).hasClass("state-off")?"false":"true")}),$("#post-preview").click(function(e){var n=$("#panels-container").closest("form"),a=n.attr("action");n.attr("action",panels.previewUrl).attr("target","_blank").submit().attr("action",a).attr("target","_self"),e.preventDefault()})),$("#panels").append('<input name="panels_js_complete" type="hidden" value="1" />')});